<!DOCTYPE html>
<html>
  <head>
    <title>SportTracks Test Page</title>
    <meta charset="utf-8" />
    <script
			  src="https://code.jquery.com/jquery-3.5.1.min.js"
			  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
			  crossorigin="anonymous"></script>
    <script src='./src/SportTracks.js'></script>
    <style>
        form  { display: table;      }
        p     { display: table-row;  }
        label { display: table-cell; vertical-align: top}
        input { display: table-cell; }
  	</style>
</head>
<body>
<h2>Testing of SportTracks Links</h2>

<form onsubmit="return getSTdata();">
  <label for="STindex">Index:&nbsp;</label>
  <input type="number" id="STindex" name="STindex" value="1" size="10" style="padding-right:5px; text-align:right;">&nbsp;
  <input type="submit" id="STget" value="Get from ST" disabled><br><br>
</form>

<form onsubmit="return setSTdata();" id="formSTdata">
	<p>
		<label id="labelSTtypedate">Type: </label>
		<input type="text" id="STtypedate" name="STtypedate" size="45" readonly>
	</p>
	<p>
		<label id="labelSTactivity">Activity: </label>
		<input type="url" id="STactivity" name="STactivity" size="45" readonly>
	</p>
  <p>
    <label for="STname" id="labelSTname">Name:      </label>
    <input type="text" id="STname" name="STname" value="Name" size="45">
	</p>
	<p>
    <label for="STdistance">Distance:&nbsp;</label>
    <input type="text" id="STdistance" name="STname" size="7" style="padding-right:25px; text-align:right;"></input><span style="margin-left:-25px;">mi</span>&nbsp;&nbsp;
	  <input type="button" id="recalcButton" onclick="alert('Lets recalc from GPX')" value="Recalc" disabled>
	</p>
  <label for="STnotes">Notes:</label>
  <textarea rows = "5" cols = "60" id="STnotes" name="STnotes">
     Enter details here...
  </textarea><br>
	<br>
  <input type="submit" id="STsend" value="Send to ST" disabled>&nbsp;&nbsp;
	<input type="button" id="STrevert" onclick="revertSTdata()" value="Revert" disabled>
	<br><br>
</form>
<br>
<br>

    <script>
      // setup SportTracksLink (if appropriate)
      //stTokens(); // setup tokens at startup - may need to refresh later
    	// where possible keep all references to HTML fields on this page - rest in SportTracks.js (change capitalization)
      sportTracksInfo(3);  // initialize

      function getSTdata() {
      	if ($("#formSTdata").serialize() != formSTdataOriginal) {
         	// warn it has changed
      		if (confirm("Data changed - override from SportTracks?") == false) {
      			return false;
      		}
      	}
        getFitnessActivityIndex( document.getElementById("STindex").value);
        return false;  // needed to avoid page refresh
      }

      function setSTdata() {
      	if (confirm("Send data to SportTracks?") == true) {
      		stActivityUpdate.notes = document.getElementById("STnotes").value;
          setFitnessActivity(stActivityUpdate);
      	}
        return false;  // needed to avoid page refresh
      }

      function revertSTdata() {
        populateSTform (stActivityInit);
      }

      // populate form
      function populateSTform (stActivity) {
          var stDate = new Date (stActivity.start_time);
          if (stTest == true) {
            window.alert("SportTracks - index " + stIndex + ": \n  " + stActivity.name + " (" + stActivity.toLocaleString() + ")\n  " + stActivity.uri);
          }
          //console.log("SportTracks - index " + stIndex + ": \n  " + stActivity.name + " (" + stDate.toLocaleString() + ")\n  " + stActivity.uri);
          //make a separate function to allow for refresh etc
          document.getElementById("STtypedate").value = stActivity.type + " (" + stDate.toLocaleString() + ")";
          document.getElementById("STactivity").value = stActivity.activity;
          document.getElementById("STname").value = stActivity.name;
          document.getElementById("STdistance").value = (stActivity.total_distance/1609.34).toFixed(2);  // convert to miles, show 2 dp
          document.getElementById("recalcButton").disabled = (typeof stActivity.location === 'undefined'); // button enabled if GPS data
          document.getElementById("STnotes").value = stActivity.notes;
          document.getElementById("STsend").disabled = false;
          document.getElementById("STrevert").disabled = false;
          // default data
          formSTdataOriginal = $("#formSTdata").serialize();
      }

    </script>
</body>
</html>
